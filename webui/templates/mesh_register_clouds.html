{% extends "layout_title.html" %}
{% from "_helper.html" import image_button %}
{% from "_helper.html" import cm_boolean_color %}
{% from "_helper.html" import cm_image_input %}

{% block contentbox %}
<h1> Register </h1>
<style>
    .modalDialog:target {
        opacity: 1;
        pointer-events: auto;
    }

    .modalDialog > div {
        width: 400px;
        position: relative;
        margin: 10% auto;
        padding: 5px 20px 13px 20px;
        border-radius: 10px;
        background: #fff;
        background: -moz-linear-gradient(#fff, #999);
        background: -webkit-linear-gradient(#fff, #999);
        background: -o-linear-gradient(#fff, #999);
    }

    .modalDialog {
        position: fixed;
        font-family: Arial, Helvetica, sans-serif;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: rgba(0,0,0,0.8);
        z-index: 99999;
        opacity: 0;
        -webkit-transition: opacity 400ms ease-in;
        -moz-transition: opacity 400ms ease-in;
        transition: opacity 400ms ease-in;
        pointer-events: none;
    }

    .close {
        background: #606061;
        color: #FFFFFF;
        line-height: 25px;
        position: absolute;
        right: -12px;
        text-align: center;
        top: -10px;
        width: 24px;
        text-decoration: none;
        font-weight: bold;
        -webkit-border-radius: 12px;
        -moz-border-radius: 12px;
        border-radius: 12px;
        -moz-box-shadow: 1px 1px 3px #000;
        -webkit-box-shadow: 1px 1px 3px #000;
        box-shadow: 1px 1px 3px #000;
    }

    .close:hover {
        background: #00d9ff;
    }
</style>
{% endblock contentbox %}

{% block content %}


{% macro password(label, cloudname) %}
   <tr>
        <td style="text-align: right">{{label}}:</td>
        <td colspan="2">
        <form>
            <input id="id-{{cloudname}}-password"
            	   valign="middle"
            	   type="password"
            	   name="field-{{cloudname}}-password"
            	   value="" autocomplete="off"
            	   placeholder="{{label}}"
            	   style="margin-bottom: 5px; margin-top: 5px;">
            <input type="button"
                   id="toggle-{{cloudname}}"
                   value="T"
                   style="display:inline"
                   onclick="toggle_PasswordFieldClicked()"/>
        </form></td>
    </tr>
{% endmacro %}

{% macro username(label, cloudname, username_edit_enabled) %}
    <tr>
        <td style="text-align: right"> Username:</td>
        <td colspan="2">
        <input id="id-{{cloudname}}-username"
               valign="middle"
               type="text"
               name="field-{{cloudname}}-username"
        	   value="psjoshi"
        	   {%if not username_edit_enabled %}
               disabled="disabled"
               {% endif %}
        style="margin-bottom: 5px; margin-top: 5px;">
        </td>
    </tr>
{% endmacro %}

{% macro openstack(cloudname, username_edit_enabled) %}
      <tr>
        <th colspan="1">
        <input type="checkbox"
                    name="field-activated-{{cloudname}}"
        			{% if cloudname in user.defaults.activeclouds %}
	           		checked = "checked"
	           		{% endif %}
        style="margin-right: 5px; vertical-align: middle;margin-bottom: 5px;">
        sierra_openstack_grizzly</th>
        <th></th>
        <th style="text-align: right"> {{ image_button ("none", "044_keys", "/updatekeypair/" + "sierra_openstack_grizzly" + "/") }}
        {{cm_boolean_color('unknown')}} </th>
    </tr>
    {{ username ("Username", cloudname, username_edit_enabled)}}
    {{ password ("Password", cloudname)}}
{% endmacro %}

{% macro aws(cloudname) %}
   <tr>
        <th colspan="1">
        <input type="checkbox"
               name="field-activated-{{cloudname}}"
               {% if cloudname in user.defaults.activeclouds %}
	           checked = "checked"
	           {% endif %}

        style="margin-right: 5px; vertical-align: middle;margin-bottom: 5px;">
        AWS</th>
        <th></th>
        <th style="text-align: right"> {{ image_button ("none", "044_keys", "/updatekeypair/" + "aws" + "/") }}
        {{cm_boolean_color('verified')}} </th>
    </tr>
    {{ username ("Username", cloudname, True)}}

    {% set accesskey= cloudname + "-accesskey" %}
    {% set secretkey= cloudname + "-secretkey" %}

    {{ password ("Access Key", accesskey)}}
    {{ password ("Secret Key", secretkey)}}

{% endmacro %}

{% macro hp(cloudname, regions) %}
    <tr>
        <th colspan="1">
        {% for region in regions %}
           <input type="checkbox"
                  name="field-activated-{{cloudname}}-{{region}}"
                  {% if "hp" in user.defaults.activeclouds %}
	              checked = "checked"
	              {% endif %}
	              style="margin-right: 5px; vertical-align: middle;margin-bottom: 5px;">
        {{region}}
        &nbsp;
        {% endfor %}
        </th>
        <th>

        </th>
        <th style="text-align: right">
        	{{ image_button ("none", "044_keys", "/updatekeypair/" + "hp" + "/") }}
        	{{cm_boolean_color('verified')}}
        </th>
    </tr>
	{{ username ("Username", cloudname, True)}}
    {{ password ("Password", cloudname)}}

{% endmacro %}



{% macro azure(cloudname) %}
    <tr>
        <th colspan="1">
        <input type="checkbox"
        	   name="field-activated-{{cloudname}}"
        	   {% if cloudname in user.defaults.activeclouds %}
	           checked = "checked"
	           {% endif %}
               style="margin-right: 5px; vertical-align: middle;margin-bottom: 5px;">
        Azure</th>
        <th></th>
        <th style="text-align: right"> {{ image_button ("none", "044_keys", "/updatekeypair/" + "azure" + "/") }}
        {{cm_boolean_color('verified')}} </th>
    </tr>
    {{ password("Subscription ID", cloudname) }}
{% endmacro %}

<table id="clouds" style="display: inline-block; float: left;">
    <tr>
        <th colspan="1"><b>Clouds <a href="#openModal"><img height="15" width="15" src="{{ url_for('static', filename='img/icons/png/glyphicons_136_cogwheel.png') }}" /></a> </b></th>
        <th></th>
        <th style="text-align: right"> {{ image_button ("none", "044_keys", "/updatekeypair/" + "hp" + "/") }}
        Verified </th>
    </tr>

	{{ openstack("sierra_openstack_grizzly", False) }}
	{{ aws("aws") }}
	{{ hp("hp", ["hp", "hp_east"]) }}
	{{ azure("azure") }}

 <!-- onclick="document.forms['profile'].submit()"/> -->

    <tr>
        <th align="center">
            Manage
        </th>
    </tr>

	<tr>
	<td colspan="3">
	<a class="btn" href="/keys">
			Keys &raquo;
		</a>
	<a class="btn" href="/mesh/cm/init/generate/me">
			Download me.yaml &raquo;
		</a>
	<a class="btn" href="/mesh/cm/init/generate/cloudmesh">
			Download cloudmesh.yaml &raquo;
		</a>

	</tr>
	</td>
</table>

<p>



<div id="openModal" class="modalDialog">
    <div>
        <a href="#close" title="Close" class="close">X</a>
        <h2>Generate Files</h2>
        <figure>
            Me.yaml{{ image_button ("none", "359_file_export", "/updatekeypair/" + "hp" + "/") }}
        </figure>
        <figure>
            Cloudmesh.yaml{{ image_button ("none", "359_file_export", "/updatekeypair/" + "hp" + "/") }}
        </figure>
    </div>
</div>

<script>
    function toggle_PasswordFieldClicked() {

        //Regex to get the password field associated with button
        //Following regex would get hpPassword from toogle_hpPassword
        var passwordFieldId = ((event.target).id.split("_"))[1];
        var passwordObject = $('#' + passwordFieldId).get(0);
        var value = passwordObject.value;

        if (passwordObject.type == 'password') {
            passwordObject.type = 'text';
        } else {
            passwordObject.type = 'password';
        }

        passwordObject.value = value;
    }
</script>

{% endblock %}